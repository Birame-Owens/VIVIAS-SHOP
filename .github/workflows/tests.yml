name: ðŸ§ª Build & Verify

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # ============================================
      # ðŸ“¦ Node.js Setup
      # ============================================
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'

      # ============================================
      # ðŸ“¦ Install dependencies
      # ============================================
      - name: Install dependencies
        run: npm ci

      # ============================================
      # ðŸ—ï¸ Build Assets
      # ============================================
      - name: Build assets
        run: npm run build

      # ============================================
      # âœ… Verify build output
      # ============================================
      - name: Verify build output
        run: |
          if [ ! -d "public/build" ]; then
            echo "âŒ Build failed - no public/build directory"
            exit 1
          fi
          echo "âœ… Build successful"
          echo "ðŸ“¦ Generated files:"
          ls -lh public/build/assets/ | grep -E '\.js$|\.css$' | head -15

      # ============================================
      # ðŸ“Š Bundle Size Check
      # ============================================
      - name: Check bundle size
        run: |
          echo "ðŸ“¦ Main chunks:"
          du -h public/build/assets/app*.js public/build/assets/react*.js public/build/assets/router*.js 2>/dev/null | sort -h || echo "âœ… Chunks verified"
          echo ""
          echo "âœ… Bundle check passed"
